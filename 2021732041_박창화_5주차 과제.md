# 5주차 강의 정리 과제
## 2021732041_전기공학과_박창화
---
## 1. State Variable Model
### 1-1. State Variable Model의 개념
- 지난시간까지 system을 풀기위해 미분방정식을 활용했다.
- 물리적 현상을 수식으로 유도해 계산을 진행, 그러나 컴퓨터를 통해 계산하거나 분업해서 계산하기 위해서는
  문제를 푸는 과정에서 체계를 만들어 나눌 필요가 있다.
- 일반적인 구조는 Input->System->Output의 순서를 가진다.
  System을 수식화 하는 과정에서 States를 정의하여 System 안의 의미있는 것들을 정의하고 이것을 중심으로 문제를 풀어보는 것.
![state variable model](https://github.com/kwupch/lecture/blob/main/state%20variable%20model.png)  
  미분방정식 안에 의미를 부여하고 싶은 부분에 State를 정의하고 이것을 중심으로 문제를 풀어나간다.  
  정리하면 State는 System안에 정의되고 이를 중심으로 문제를 풀이한다. 이때 state는 input에도 영향을 받고 state끼리도
  영향을 주고받는 관계를 가진다. 또한 최종적으로 output은 state와 input의 조합으로 그 값을 구하게 된다.
  이는 식을 단순한 미분방정식으로 바꾸고 컴퓨터가 계산하기 편한 행렬방정식의 형태로 변화시키는 역할을 하게 된다.

### 1-2. SMD System 해석에서의 이용
![SMD System](https://github.com/kwupch/lecture/blob/main/SMD%20system.png)  
- System의 기본 운동 방정식
  
$$M\frac{{d^2}y(t)}{dt^2}+b\frac{dy(t)}{dt}+ky(t)=r(t)$$  

- 기존 방식은 미분방정식을 라플라스 변환한 후 식을 정리하고 다시 역 라플라스 변환해 y(t)의 값을 구했다.  
  State를 정의하여 문제를 풀기 위해 $x_1=y(t)$, $x_2=\frac{dy(t)}{dt}$의 두 State를 정의  
  2개를 정의한 이유는 SMD System의 운동방정식이 2차 미분방정식이기 때문  
  미분방정식을 푸는 과정에서 2차 미분방정식은 라플라스 변환 후 $s^2$의 항이 존재하기 때문에 해가 2개가 된다.  
  따라서 미지수가 2개인 것과 같으므로 State를 2개 정의하여 문제를 풀어야한다.  
 이때 $x_1$은 질량 M의 변위, $x_2$는 변위의 미분인 속도에 해당한다.
- $M\frac{{d^2}y(t)}{dt^2}+b\frac{dy(t)}{dt}+ky(t)=r(t)$의 식을 $x_1$, $x_2$에 대한 식으로 나타내면 아래의 두 식으로 정리할 수 있다.

$$\frac{dx_1(t)}{dt}=x_2(t) \qquad (y(t)=x_1(t) 이용)$$  
$$\frac{dx_2(t)}{dt}=\frac{-b}{M}x_2(t)+\frac{-k}{M}x_1(t)+\frac{1}{M}r(t)$$
  
- Output의 식은 아래와 같이 나타난다. 
  
$$y(t)=x_1(t)$$  
  
- 위 두 식은 2차 미분방정식과 State를 정의한 두 수식을 조합해 2개의 미분방정식으로 도출된 결과이다.  
  위 과정을 통해 2차 미분방정식을 2개의 1차 미분방정식으로 바뀐 것과 같다.  
  따라서 복잡한 미분방정식을 간단한 연립 미분방정식으로 바꾸어 일종의 행렬로 바뀌어 컴퓨터로 연산이 쉬워지는 효과를 볼 수 있다.

### 1-3. RLC 회로 해석에서의 이용
![RLC circuit](https://github.com/kwupch/lecture/blob/main/RLC.png)
- State 정의

$$x_1(t)=v_c(t)$, $x_2(t)=i_L(t)$$

- State는 항등식이 되지않는 선에서 서로 독립적인 State를 정의하기만 하면 문제를 풀 수 있음  
  그러나 문제를 푸는 과정이 쉽고 어려운 State는 존재, 따라서 문제 풀이에 적절한 State를 고르는 것이 중요하다.
- KCL을 이용해 식을 정리
  
$$u(t)=C\frac{dx_1(t)}{dt}+x_2(t) \rightarrow \frac{dx_1(t)}{dt}=\frac{1}{C}[-x_2(t)+u(t)]$$

- KVL을 이용해 식을 정리

$$L\frac{dx_2(t)}{dt}+Rx_2(t)-x_1(t)=0 \rightarrow \frac{dx_2(t)}{dt}=\frac{1}{L}[x_1(t)-Rx_2(t)]$$

- 위 두 식을 통해 2차 미분방정식으로 해석해야할 회로를 1차 미분방정식 2개를 연립하여 계산할 수 있다는 점을 알 수 있다.

$$\frac{dx_1(t)}{dt}=\frac{1}{C}[-x_2(t)+u(t)]$$
$$\frac{dx_2(t)}{dt}=\frac{1}{L}[x_1(t)-Rx_2(t)]$$

- 이때 output은 아래 식과 같다.
  
$$y(t)=Rx_2(t)$$  

## 2. State Space Equation
### 2-1. 1st order state differential equation
- State를 정의하면 1차 미분방정식의 연립이 됨  
  $\dot{x}(t) = ax(t)+bu(t)$  
  라플라스 변환한 식은 $sX(s)-x(0)=aX(s)+bU(s)$  
  $X(s)$에 관해 정리하면 $X(s)=\frac{1}{s-a}x(0)+\frac{1}{s-a}bU(s)$  
  이를 다시 역 라플라스 변환하여 $x(t)$에 관한 식을 얻어낼 수 있다.  
  $x(t)=e^{at}x(0)+\int e^{a(t-\tau)}bu(\tau)d\tau$  
  1차 미분방정식을 풀어 해 $x(t)$를 구하는 과정에 해당한다.
- $\Phi(t)=e^{at}$라 하면 $x(t)$에 관한 식을 아래와 같이 정리할 수 있음  
  $x(t)=\Phi(t)·x(0)+\int\Phi(t-\tau)bu(\tau)dt$  
  왼쪽은 $\Phi(t)·x(0)$는 초기값 $x(0)$에 $\Phi(t)$를 곱한 식, Transition from initial state  
  오른쪽은 input $u(\tau)$에 대해 $\Phi(t)$를 이용해 나타낸 식, Effect of input  
  정리하면 왼쪽은 초기상태가 $\Phi(t)$에 의해 변화한 것을 나타내고  
  오른쪽은 Input이 $\Phi(t)$에 의해 변화하였음을 나타낸다.
  이는 State를 정의해 문제를 정리하면 그 해가 초기상태와 Input과 관련된 식으로 나타낼 수 있음을 의미한다.
### 2-2. State vector
- 다차 미분방정식은 State가 하나가 아닌 여러개가 정의된다. 따라서 일반적으로 State는 벡터의 형태로 나타낸다.  

$$
\mathbf{x}(t) =
\begin{pmatrix}
x_1(t) \\
x_2(t) \\
\vdots \\
x_n(t)
\end{pmatrix}
$$

- State differential equation은 다차 미분 방정식을 여러개의 1차 미분방정식으로 바꿔 1차 행렬미분방정식으로 바꾼 식  
State vector의 미분은 State vector에 A행렬을 곱한것과 Input vector에 B 행렬을 곱한것과 같다.  
$\dot{x}(t) = Ax(t)+Bu(t)$
- Output equation은 State와 Input을 조합해 Output을 구하는 식  
Output에 관한 식도 행렬을 사용하여 나타낼 수 있다.  
$y(t)=Cx(t)+Du(t)$
- 위 두 식을 묶어 State Space Equation이라 칭한다.  
State Space Equation의 장점은 State에 의미를 부여해 수식의 풀이 중간과정에서 그 의미를 파악하기 용이하고
다차 미분방정식이 1차 행렬 미분방정식으로 단순화 되어 컴퓨터를 사용한 연산이 편리해진다.   
### 2-3. State transition matrix
- 1차 미분방정식의 해  
$x(t)=e^{at}x(0)+\int e^{a(t-\tau)}bu(\tau)d\tau$
- 다차 미분방정식의 해  
$x(t)=exp(At)x(0)+\int exp[A(t-\tau)]Bu(\tau)d\tau$  
위 식을 행렬을 기준으로 라플라스 변환한 식  
$x(s)=[sI-A]^{-1}x(0)+[sI-A]^{-1}BU(s)$  
$\Phi(s)=[sI-A]^{-1}$로 정의  
$\Phi(t)=L^{-1}[\Phi(s)]$이므로  
따라서 결과적으로 $x(t)=\Phi(t)·x(0)+\int\Phi(t-\tau)bu(\tau)dt$ 와 같은 식이 된다.  
이때 $\Phi(t)$를 State transition matrix라 한다.

## 3. 예제 풀이
![ex3.1](https://github.com/kwupch/lecture/blob/main/ex3.1.png)

- 문제를 풀기 위한 운동방정식
  $$M_1\ddot{p}(t)=u(t)-b_1[\dot{p}(t)-\dot{q}(t)]-k_1[p(t)-q(t)]$$  
  $$M_2\ddot{q}(t)=b_1[\dot{p}(t)-\dot{q}(t)]+k_1[p(t)-q(t)]-b_2\dot{q}(t)-k_2q(t)$$
- 질량마다 힘이 존재하므로 2차 미분방정식 2개가 생기고 라플라스변환으로 풀기 위해서는 4차 미분방정식을 풀어내야함
  이를 단순화해서 풀기 위해 state vector $x(t)$를 다음과 같이 정의함  

$$
x(t) =
\begin{pmatrix}
x_1(t) \\
x_2(t) \\
x_3(t) \\
x_4(t)
\end{pmatrix}=
\begin{pmatrix}
p(t) \\
q(t) \\
\dot{p}(t) \\
\dot{q}(t)
\end{pmatrix}
$$

- 이를 통해 1차 행렬 미분방정식으로 나타내면 아래 식과 같이 나타난다.

$$
\dot{x}(t) =
\begin{bmatrix}
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1 \\
-\dfrac{k_1}{M_1} & \dfrac{k_1}{M_1} & -\dfrac{b_1}{M_1} & \dfrac{b_1}{M_1} \\
\dfrac{k_1}{M_2} & -\dfrac{k_1 + k_2}{M_2} & \dfrac{b_1}{M_2} & -\dfrac{b_1 + b_2}{M_2}
\end{bmatrix}
\mathbf{x}(t)
+
\begin{bmatrix}
0 \\ 
0 \\ 
\dfrac{1}{M_1} \\ 
0
\end{bmatrix}
u(t)
$$

- 교과서의 값을 대입하고 y(t)=p(t), u(t)=0이라고 가정하였을때 matlab 코드로 값 구하기
```
k1 = 150; % N/m
k2 = 700; % N/m
b1 = 15;  % Ns/m
b2 = 30;  % Ns/m
M1 = 5;   % kg
M2 = 20;  % kg

A = [0, 0, 1, 0;
     0, 0, 0, 1;
    -k1/M1, k1/M1, -b1/M1, b1/M1;
     k1/M2, -(k1+k2)/M2, b1/M2, -(b1+b2)/M2];
B = [0; 0; 1/M1; 0];
C = [1, 0, 0, 0];
D = 0;

sys = ss(A, B, C, D);
x0 = [0.1, 0, 0, 0];
initial(sys, x0, [0, 5]);
```


